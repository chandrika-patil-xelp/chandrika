<?php include 'jBhead.html' ?>
    <body>
        <div class="container allProducts">
            <?php include 'jBheader.html' ?>
            <div class="contents fLeft">
                <div class="wrapperMax">
                    <div class="couponCont fLeft">
                        <div class="prdSearchDiv fLeft fmOpenR">
                            <div class="commTitle2 fLeft"><span id='productCnt'>NA</span> products available</div>
                            <div class="addCouponBtn fRight transition300"><a href='<?php echo BACKDOMAIN;?>?action=addProduct'>Add Product</a></div>
                            <input type="text"  autocomplete="off" class="prdSeachTxt fRight fmOpenR" placeholder=" Search Product">
                        </div>
                        <div class="cpListHeader fLeft fmOpenR">
                            <div class="date fLeft">Date</div>
                            <div class="stockCode fLeft">Stock Code</div>
                            <div class="prdName fLeft">Product Name</div>
                            <div class="dmdWt fLeft">Diamond Wt</div>
                            <div class="metalWt fLeft">Metal Wt</div>
                            <div class="acct fLeft">Action</div>
                        </div>
                        <ul class="couponList fLeft fmOpenR" id='productList'></ul>
                        <div class="noresDiv fLeft dn" id='noresults'>
                            <div class="noresults font25 fLeft">There are no products available.</div>
                        </div>
                    </div>
                    
                    <div class="fLeft pagination fmOpenR dn">
                        <center>
                            <div class="pPrev poR transition300">Previous</div>
                            <div class="pgComm poR transition300 pgActive">1</div>
                            <div class="pgComm poR transition300">2</div>
                            <div class="pNext poR transition300">Next</div>
                        </center>
                    </div>
                </div>
            </div>
        </div>
        
       
        <script>
            var prdCnt=0;
            $(document).ready(function() {
                getProducs();
            });
                        
            function inStock(obj,pid)
            {
                var val=$(obj).val();
                
                if(val==1)
                    $(obj).addClass('inStockPrd').removeClass('outStockPrd');
                else
                    $(obj).addClass('outStockPrd').removeClass('inStockPrd');
                
                changePrdStatus(val,pid);
                
            }
            
            function changePrdStatus(val,pid)
            {
                
                values= {};
                values['active_flag']=val;
                values['pid']=pid;
                var data = values;
                var dt = JSON.stringify(data);
                
                var URL=APIDOMAIN+"?action=changeProductStatus";
                $.ajax({
                    url:URL,
                    type: 'POST',
                    data: {dt: dt},
                    success: function(res) {
                        res = JSON.parse(res);
                        changeStatusCallBack(res);
                    }
                });
                
            }
            
            
            
            function changeStatusCallBack(data)
            {

                if (data['error']['err_code'] == '0')
                {
                    common.toast(1, 'Status updated successfully');
                    getProducs();
                }
                else
                {
                    common.toast(0, 'Error in updating status');
                    getProducs();
                }
            }

            
            
            
            function getProducs()
            {   
                prdCnt=0;
                var URL=APIDOMAIN+"?action=pageList&page1&limit=20";
                $.ajax({
                    url:URL,
                    type:'POST',
                    success:function(res){
                        res=JSON.parse(res);
                        getProducsCallback(res);
                    }
                });
            }
            
            function getProducsCallback(data)
            {
                
               if (data['error']['err_code'] == '0')
                {
                    var str="";   
                    $(data['results']).each(function(i,v){
                        
                        
                        if(v.isActive!=2)
                        {
                            
                            prdCnt++;
                            var cdat = v.creDate.split("|");
                            str+="<li>";
                            str+="<div class='date fLeft'>";
                            str+="<span class='upSpan'>"+cdat[0]+"</span>";
                            str+="<span class='lwSpan'>"+cdat[1]+"</span>";
                            str+="</div>";
                            str+="<div class='stockCode fLeft'>";
                            str+="<span class='upSpan fmOpenB'>"+v.prdCode+"</span>";
                            str+="<span class='lwSpan'><a href='" + APIDOMAIN + "?action=getProductById&pid=" + v.pid + "'>View Details</a></span>";
                            str+="</div>";
                            str+="<div class='prdName fLeft'>"+v.prdName+"</div>";
                            str+="<div class='dmdWt fLeft'>"+v.diaWgt+" ct</div>";
                            str+="<div class='metalWt fLeft'>"+v.mtlWgt+" gms</div>";
                            str+="<div class='acct fLeft'>";
                            str+="<div class='deltBtn fRight transition300'  onclick=\"changePrdStatus(2,'"+v.pid+"')\"></div>";
                            str+="<div class='editBtn fRight transition300'></div>";
                            str+="<a href='" + DOMAIN + "backend/?action=upload&pid=" + v.pid + "' target='+blank'><div class='uploadBtn fRight transition300'></div></a>";
                            if(v.isActive==1)
                            {
                                str+="<select class='backtxtSelect fmOpenR fRight inStockPrd' onchange=\"inStock(this,'"+v.pid+"')\">";
                                str+="<option value='1' selected='selected'>Active</option>";
                                str+="<option value='0'>Dactive</option>";
                            }
                            if(v.isActive==0)
                            {
                                str+="<select class='backtxtSelect fmOpenR fRight outStockPrd' onchange=\"inStock(this,'"+v.pid+"')\">";
                                str+="<option value='1'>Active</option>";
                                str+="<option value='0' selected='selected'>Dactive</option>";
                            }
                            str+="</select>";
                            str+="</div>";
                            str+="</li>";
                        }    
                    });
                    
                    if(prdCnt==0)
                    {
                        $('#noresults').removeClass('dn');
                    }
                    else
                    {
                        $('#noresults').addClass('dn');
                    }
                    
                    $('#productList').html(str);
                    $('#productCnt').html(prdCnt);
                   
                }
                else
                {
                    common.toast(0, 'Error in fetching products');
                    //getProducs();
                }
                
            }
            
            
            
        </script>
    </body>
</html>